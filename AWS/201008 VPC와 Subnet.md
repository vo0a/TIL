## 201008 VPC와 Subnet

> IP 주소 범위와 VPC 범위를 설정하고 서브넷을 추가하고 보안 그룹을 연결한 다음 라우팅테이블을 구성. 인터넷을 이용하는 경우 인터넷 게이트웨이를 설정하고 라우팅 테이블에 등록

[진수님의 멋진 설명](https://www.notion.so/ausgga/2020-10-08-VPC-Subnet-039792a6ab6547bfb82e93a3cfd78e74)



## 이론 설명

**AWS는 VPC라는 가상 네트워크를 사용함**

-  물리적이 아닌 논리적으로 분리되어 있음.



- 서브넷은 네트워크를 쪼개서 네트워크를 만든다? 그러면 서브넷은 네트워크인가? 
  - 아무튼 AWS에서는 네트워크가 아닌 IP대역을 말한다.
  - 내가 지정하지 않아도 디폴트 VPC를 생성해줌
  - 직접 서브넷을 만들 수도 있음.



**게이트웨이와 라우팅의 차이**

- 게이트웨이는 소프트웨어 개념적, 라우터는 하드웨어 장비.



**AWS에서**

- 디폴트 VPC
- 디폴트 서브넷(ec2).
  - 가용영역이 나눠져 있고 
- 서브넷은 하나의 네트웍이다.
- 네트웍은 VPC
- 라우팅 테이블에서 프라이빗, 퍼블릭을 결정하는 것.



## 실습

1. VPC 생성
   - **Name** ausg-4th
   - **IPv4 CIDR** 10.0.0.0/27
2. 서브넷 생성
   - **Name** ausg-4th
   - **IPv4 CIDR** 10.0.0.0/28
   - 자동 할당 IP 설정 수정
     - 퍼블릭 IPv4 주소 자동 할당 활성화 (생성한 VPC와 연결)
3. ec2 생성
   - ubuntu 프리티어용으로 생성함
   - `인스턴스 구성` 단계에서 아래 두 항목에 위에서 생성한 VPC와 서브넷을 지정해줌
     - 네트워크 - ausg-4th
     - 서브넷 - ausg-4th-public
   - 보안그룹 모두 삭제 후 생성
   - 키 페어 생성
   - ssh 접속
     - 이상태로 ec2에 ssh 접속해보면, 접속이 안되는게 정상!!
       - 요청은 가지만 응답은 없는 상태
     - 접속하기 위해서는 **보안그룹** 설정해야 함
       - SSH TCP 포트범위 22 0.0.0.0/0 으로 설정
       - 하지만 아직 안 됨. 4,5 번을 거쳐야 완성 → 인터넷 연결 때문

4. 라우팅 테이블
   - VPC ID를 보면 VPC에서 생성한 ausg-4th 가 보일 것.
   - 해당 테이블을 선택하고, 라우팅 편집
   - 라우팅 추가 - `0.0.0.0/0`  `Internet Gateway`

5. 인터넷 게이트웨이 생성

   - **Name** ausg-4th
   - VPC에 연결 - 위에서 생성한 VPC에 연결

6. 모든 설정을 마쳤으니 ping을 날려보자

   - 4~5번 단계를 거쳐서 ec2에 접속 성공할 것
   - 핑을 날려보자 `ping ec2-public-ip`

   - 무한대기가 일어남 → ec2 **보안그룹** 수정!

     - ICMP-IPv4 의 모든 주소로 해야함. 

       - 내 IP 주소로만 설정해두니까 핑이 안찍힘

       ![화면 캡처 2020-10-08 215041](https://user-images.githubusercontent.com/44438366/95465256-dad42980-09b5-11eb-8c6e-330e878f5953.png)

     - 아래와 같이 찍히면 완성!
       
       ![화면 캡처 2020-10-08 214817](https://user-images.githubusercontent.com/44438366/95464996-934d9d80-09b5-11eb-9b9a-09e3483f82e3.png)

</br>

vpc랑 서브넷은 돈 안나가니까 괜찮지만 ec2는 지우세요~



## Q&A

```
[Question] 
1. 근데 따로 생성한 VPC로 ec2를 사용하려면, '인터넷 게이트웨이, 라우팅 테이블' 이 두 가지를 모두 설정해야 인터넷 연결이 완료된건가요? 
2. 인터넷 연결 안될 때는 ec2 접속이 안되나요?

[Answer]
1. 네.
2. 인터넷 => EC2로 요청은 가는데
EC2가 응답을 줄 때 어느 곳으로 줄 지를 route table 보고 줄 것 같은데 거기에 인터넷에 대한 경로설정이 없어서??
```

